Как должна работать программа

Входные данные
Пользователь кладёт в «входную» папку разные документы: PDF, сканы, фото чеков и т.д.

Предобработка

Если файл — картинка или скан, программа запускает OCR и вытаскивает текст.

Если файл — PDF с текстом, извлекается текст напрямую.

Вытягиваются метаданные (дата создания файла, имя, размер и т.д.).

Анализ содержимого (ИИ-этап)

Из полученного текста вызывается LLM (через OpenRouter).

Модель возвращает структурированный JSON с полями:

категория (например, Receipts, Insurance, School),

подкатегория,

дата,

отправитель/организация (issuer),

человек (person),

тип документа,

сумма (если есть),

теги (для поиска),

предложенное имя файла,

краткое примечание.

Если что-то не найдено — поле пустое.

Построение пути
Программа формирует путь для хранения:

/Архив/<Категория>/<Подкатегория>/<Человек или Организация>/<Имя файла>


Например:

/Архив/Receipts/Online/Amazon/2024-11-02__Amazon__Rechnung__19.99-EUR.pdf


Перемещение и сохранение

Файл перемещается/копируется в нужную папку.

Рядом создаётся .json с метаданными.

В лог пишется, что куда ушло.

Если включён режим dry-run — только показывается план действий без перемещения.

Ошибки и исключения

Если LLM вернул невалидный JSON, программа пытается ещё раз.

Если снова ошибка — документ уходит в папку Unsorted.

В лог записывается текст ошибки.

Конфигурация

Списки категорий, имён людей и вендоров берутся из config.yml.

Можно добавить свои правила (например, всё с «IKEA» → папка Receipts/IKEA).

Модель и ключ OpenRouter указываются в .env.

Производительность и лимиты

Документы обрабатываются по очереди, чтобы не упираться в лимиты API.

При превышении лимита запросы повторяются с задержкой.

